<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ë§ê½ƒ í†¡í†¡</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <style>
        html, body { 
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; 
            background-color: #f0f0f0; 
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #app-frame {
            position: relative;
            width: 100%;
            max-width: 450px;
            height: 100%; 
            max-height: 900px;
            margin: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1); 
            border-radius: 20px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-color: white;
        }
        #swiper-container { 
            width: 100%;
            flex-grow: 1;
        }
        .swiper-wrapper { 
            height: 100%;
        }
        .swiper-slide {
            height: 100%; 
            background-color: white; 
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            display: flex; 
            flex-direction: column; 
            justify-content: flex-end; 
            align-items: center; 
            padding-bottom: 30px; 
        }
        .button-container { 
            display: flex;
            gap: 15px; 
            justify-content: center; 
            align-items: center;
        }
        .next-button, .restart-button, .exit-button { 
            padding: 15px 40px; 
            font-size: 18px;
            font-weight: 600; 
            background-color: #688b4d; 
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(104, 139, 77, 0.3); 
            transition: transform 0.2s, box-shadow 0.2s; 
        }
        .next-button:active, .restart-button:active, .exit-button:active { 
            transform: scale(0.95); 
        }
    </style>
</head>
<body>
    <div id="app-frame">
        <div id="swiper-container" class="swiper">
            <div class="swiper-wrapper"></div>
        </div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            // ì´ë¯¸ì§€ ê¸°ë³¸ URL
            const baseImageUrl = 'https://malkkotinfo-dev.github.io/toktok/images/';
            
            // ìºì‹œ ë°©ì§€ë¥¼ ìœ„í•œ ë²„ì „ ë²ˆí˜¸ (íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤ ê°’ìœ¼ë¡œ ê°•ë ¥í•œ ìºì‹œ ë²„ìŠ¤íŒ…)
            const imageVersion = '?v=' + Date.now() + '&r=' + Math.random().toString(36).substring(7);
            
            // ì²« ì¥: ìŠ¤í”Œë˜ì‹œ ìŠ¤í¬ë¦°
            const splashImage = baseImageUrl + 'splash.png' + imageVersion;
            
            // ë‹¨ì–´ ì¹´ë“œ ì´ë¯¸ì§€ë“¤
        const words = [
                { id: 1, text: 'ì‚¬ê³¼', image: baseImageUrl + 'apple.png' + imageVersion },
                { id: 2, text: 'ë°”ë‚˜ë‚˜', image: baseImageUrl + 'banana.png' + imageVersion },
                { id: 3, text: 'ë”¸ê¸°', image: baseImageUrl + 'strawberry.png' + imageVersion },
                { id: 4, text: 'í¬ë„', image: baseImageUrl + 'grape.png' + imageVersion },
                { id: 5, text: 'ìˆ˜ë°•', image: baseImageUrl + 'watermelon.png' + imageVersion },
                { id: 6, text: 'ê·¤', image: baseImageUrl + 'tangerine.png' + imageVersion },
                { id: 7, text: 'ë°°', image: baseImageUrl + 'pear.png' + imageVersion },
                { id: 8, text: 'ë³µìˆ­ì•„', image: baseImageUrl + 'peach.png' + imageVersion },
                { id: 9, text: 'ì˜¤ë Œì§€', image: baseImageUrl + 'orange.png' + imageVersion },
                { id: 10, text: 'í‚¤ìœ„', image: baseImageUrl + 'kiwi.png' + imageVersion },
                { id: 11, text: 'ì°¸ì™¸', image: baseImageUrl + 'melon.png' + imageVersion },
                { id: 12, text: 'íŒŒì¸ì• í”Œ', image: baseImageUrl + 'pineapple.png' + imageVersion },
                { id: 13, text: 'ê°•ì•„ì§€', image: baseImageUrl + 'dog.png' + imageVersion },
                { id: 14, text: 'ê³ ì–‘ì´', image: baseImageUrl + 'cat.png' + imageVersion },
                { id: 15, text: 'í˜¸ë‘ì´', image: baseImageUrl + 'tiger.png' + imageVersion },
                { id: 16, text: 'ì‚¬ì', image: baseImageUrl + 'lion.png' + imageVersion },
                { id: 17, text: 'ì½”ë¼ë¦¬', image: baseImageUrl + 'elephant.png' + imageVersion },
                { id: 18, text: 'ê¸°ë¦°', image: baseImageUrl + 'giraffe.png' + imageVersion },
                { id: 19, text: 'í† ë¼', image: baseImageUrl + 'rabbit.png' + imageVersion },
                { id: 20, text: 'ì›ìˆ­ì´', image: baseImageUrl + 'monkey.png' + imageVersion },
                { id: 21, text: 'ê³°', image: baseImageUrl + 'bear.png' + imageVersion },
                { id: 22, text: 'ë¼ì§€', image: baseImageUrl + 'pig.png' + imageVersion },
                { id: 23, text: 'ë‹­', image: baseImageUrl + 'chicken.png' + imageVersion },
                { id: 24, text: 'ë³‘ì•„ë¦¬', image: baseImageUrl + 'chick.png' + imageVersion }
            ];
            
            // ë§ˆì§€ë§‰ ì¥: í”¼ë“œë°± í˜ì´ì§€ (ì—¬ëŸ¬ ê°€ëŠ¥í•œ íŒŒì¼ëª… ì‹œë„)
            const feedbackImageOptions = [
                baseImageUrl + 'feedback.png',
                baseImageUrl + 'outro.png',
                baseImageUrl + 'end.png'
            ];
            const feedbackImage = feedbackImageOptions[0] + imageVersion;

            const swiperContainer = document.getElementById('swiper-container');
            const swiperWrapper = swiperContainer.querySelector('.swiper-wrapper');
        let swiper;

            // ìŠ¬ë¼ì´ë“œ ìƒì„± í•¨ìˆ˜
            function createSlide(imageUrl, slideIndex, totalSlides, slideType) {
                const slide = document.createElement('div');
                slide.className = 'swiper-slide';
                slide.style.backgroundColor = 'white';
                slide.dataset.slideType = slideType;
                slide.dataset.slideIndex = slideIndex;
                
                // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ í…ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ
                const fallbackText = document.createElement('div');
                fallbackText.className = 'fallback-text';
                fallbackText.style.padding = '40px';
                fallbackText.style.textAlign = 'center';
                fallbackText.style.flexGrow = '1';
                fallbackText.style.display = 'flex';
                fallbackText.style.flexDirection = 'column';
                fallbackText.style.justifyContent = 'center';
                fallbackText.style.alignItems = 'center';
                
                if (slideType === 'splash') {
                    fallbackText.innerHTML = '<h2 style="font-size: 28px; margin-bottom: 20px; color: #688b4d;">ë§ê½ƒì´ë„¤</h2><p style="font-size: 18px; color: #666;">ë‹¨ì–´ì¹´ë“œ</p>';
                } else if (slideType === 'feedback') {
                    fallbackText.innerHTML = '<h2 style="font-size: 24px; margin-bottom: 20px;">ğŸ‰ í•™ìŠµ ì™„ë£Œ! ğŸ‰</h2><p style="font-size: 18px; margin-bottom: 10px;">í•™ìŠµì€ ì–´ë– ì…¨ë‚˜ìš”?</p><p style="font-size: 16px; color: #666;">ì¶”ê°€ ì˜ê²¬ì´ ìˆë‹¤ë©´<br>ì¸ìŠ¤íƒ€ê·¸ë¨ DM ë˜ëŠ” ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”!</p>';
                } else {
                    fallbackText.style.display = 'none';
                }
                
                // ì´ë¯¸ì§€ ë¡œë“œ í™•ì¸ (ê°•ë ¥í•œ ìºì‹œ ë²„ìŠ¤íŒ… ì ìš©)
                const img = new Image();
                // ì´ë¯¸ì§€ URLì— ì¶”ê°€ ìºì‹œ ë²„ìŠ¤íŒ… íŒŒë¼ë¯¸í„° ì¶”ê°€ (ë§¤ë²ˆ ê³ ìœ í•œ ê°’)
                const uniqueCacheBust = Date.now() + '-' + Math.random().toString(36).substring(2, 15);
                const imageUrlWithCacheBust = imageUrl.split('?')[0] + '?v=' + uniqueCacheBust + '&t=' + Date.now();
                
                console.log('ğŸ–¼ï¸ ì´ë¯¸ì§€ ë¡œë“œ ì‹œë„:', imageUrl.split('?')[0], 'â†’', imageUrlWithCacheBust);
                
                img.onload = function() {
                    console.log('âœ… ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ:', imageUrl.split('?')[0], 'slideType:', slideType);
                    slide.style.backgroundImage = `url('${imageUrlWithCacheBust}')`;
                    if (slideType !== 'splash' && slideType !== 'feedback') {
                        fallbackText.style.display = 'none';
                    } else {
                        // ìŠ¤í”Œë˜ì‹œë‚˜ í”¼ë“œë°±ì€ ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ë©´ í…ìŠ¤íŠ¸ ìˆ¨ê¹€
                        fallbackText.style.display = 'none';
                    }
                };
                img.onerror = function() {
                    console.error('âŒ ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨:', imageUrl.split('?')[0], 'slideType:', slideType, 'index:', slideIndex);
                    console.error('ì‹œë„í•œ URL:', imageUrlWithCacheBust);
                    slide.style.backgroundImage = 'none';
                    // ìŠ¤í”Œë˜ì‹œë‚˜ í”¼ë“œë°±ì€ ì´ë¯¸ì§€ê°€ ì—†ì–´ë„ í…ìŠ¤íŠ¸ í‘œì‹œ
                    if (slideType === 'splash' || slideType === 'feedback') {
                        fallbackText.style.display = 'flex';
                    }
                };
                // ìºì‹œ ë¬´ì‹œ ì˜µì…˜ê³¼ í•¨ê»˜ ì´ë¯¸ì§€ ë¡œë“œ
                img.crossOrigin = 'anonymous';
                img.src = imageUrlWithCacheBust;
                
                const buttonContainer = document.createElement('div');
                buttonContainer.className = 'button-container';
                
                const isFirstSlide = slideIndex === 0;
                const isLastSlide = slideIndex === totalSlides - 1;
                
                // ë‹¤ìŒ ë²„íŠ¼
                const nextButton = document.createElement('button');
                nextButton.className = 'next-button';
                nextButton.style.display = isLastSlide ? 'none' : 'block';
                if (isFirstSlide) {
                    nextButton.textContent = 'ì‹œì‘í•˜ê¸°';
                } else {
                    nextButton.textContent = 'ë‹¤ìŒ';
                }
                nextButton.addEventListener('click', () => {
                    if (swiper) {
                        swiper.slideNext();
                    }
                });
                
                // ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸° ë²„íŠ¼
                const restartButton = document.createElement('button');
                restartButton.className = 'restart-button';
                restartButton.textContent = 'ì²˜ìŒë¶€í„° ë‹¤ì‹œ í•˜ê¸°';
                restartButton.style.display = isLastSlide ? 'block' : 'none';
                restartButton.style.visibility = isLastSlide ? 'visible' : 'hidden';
                restartButton.addEventListener('click', () => {
                    if (swiper) {
                        swiper.slideTo(0);
                    }
                });
                
                // ì¢…ë£Œí•˜ê¸° ë²„íŠ¼
                const exitButton = document.createElement('button');
                exitButton.className = 'exit-button';
                exitButton.textContent = 'ì¢…ë£Œí•˜ê¸°';
                exitButton.style.display = isLastSlide ? 'block' : 'none';
                exitButton.style.visibility = isLastSlide ? 'visible' : 'hidden';
                exitButton.addEventListener('click', () => {
                    if (confirm('ì •ë§ ì¢…ë£Œí•˜ì‹œê² ì–´ìš”?')) {
                        window.close();
                    }
                });
                
                buttonContainer.appendChild(nextButton);
                buttonContainer.appendChild(restartButton);
                buttonContainer.appendChild(exitButton);
                
                slide.appendChild(fallbackText);
                slide.appendChild(buttonContainer);
                
                return slide;
            }

            // Swiper ì´ˆê¸°í™”
            function initializeSwiper() {
                swiperWrapper.innerHTML = '';
                
                const totalSlides = words.length + 2; // ìŠ¤í”Œë˜ì‹œ + ë‹¨ì–´ë“¤ + í”¼ë“œë°±
                
                console.log('ìŠ¬ë¼ì´ë“œ ì´ˆê¸°í™” ì‹œì‘. ì´ ìŠ¬ë¼ì´ë“œ ìˆ˜:', totalSlides);
                console.log('ì²« ì¥ ì´ë¯¸ì§€:', splashImage);
                console.log('ë§ˆì§€ë§‰ ì¥ ì´ë¯¸ì§€:', feedbackImage);
                
                // ì²« ì¥: ìŠ¤í”Œë˜ì‹œ ìŠ¤í¬ë¦°
                const splashSlide = createSlide(splashImage, 0, totalSlides, 'splash');
                swiperWrapper.appendChild(splashSlide);
                console.log('ì²« ì¥ ì¶”ê°€ ì™„ë£Œ');
                
                // ë‹¨ì–´ ì¹´ë“œë“¤
                words.forEach((word, index) => {
                    const slide = createSlide(word.image, index + 1, totalSlides, 'word');
                    swiperWrapper.appendChild(slide);
                });
                console.log('ë‹¨ì–´ ì¹´ë“œ ì¶”ê°€ ì™„ë£Œ:', words.length, 'ê°œ');
                
                // ë§ˆì§€ë§‰ ì¥: í”¼ë“œë°± í˜ì´ì§€
                const feedbackSlide = createSlide(feedbackImage, words.length + 1, totalSlides, 'feedback');
                swiperWrapper.appendChild(feedbackSlide);
                console.log('ë§ˆì§€ë§‰ ì¥ ì¶”ê°€ ì™„ë£Œ');
                
                console.log('ìƒì„±ëœ ìŠ¬ë¼ì´ë“œ ìˆ˜:', swiperWrapper.children.length);
                
                // Swiper ì´ˆê¸°í™”
                swiper = new Swiper(swiperContainer, {
                    loop: false,
                    allowTouchMove: true,
                    on: {
                        slideChange: function() {
                            updateButtons();
                        }
                    }
                });
                
                // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
                setTimeout(() => {
                    updateButtons();
                    console.log('í˜„ì¬ ìŠ¬ë¼ì´ë“œ ì¸ë±ìŠ¤:', swiper.activeIndex, '/', swiper.slides.length - 1);
                }, 100);
            }
            
            // ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
            function updateButtons() {
                if (!swiper) return;
                
                const slides = swiper.slides;
                const currentIndex = swiper.activeIndex;
                const isLastSlide = currentIndex === slides.length - 1;
                const isFirstSlide = currentIndex === 0;
                
                slides.forEach((slide, index) => {
                    const nextButton = slide.querySelector('.next-button');
                    const restartButton = slide.querySelector('.restart-button');
                    const exitButton = slide.querySelector('.exit-button');
                    
                    if (index === currentIndex) {
                        // í˜„ì¬ ìŠ¬ë¼ì´ë“œ
                        if (isLastSlide) {
                            // ë§ˆì§€ë§‰ í˜ì´ì§€ (í”¼ë“œë°± í˜ì´ì§€)
                            if (nextButton) nextButton.style.display = 'none';
                            if (restartButton) {
                                restartButton.style.display = 'block';
                                restartButton.style.visibility = 'visible';
                            }
                            if (exitButton) {
                                exitButton.style.display = 'block';
                                exitButton.style.visibility = 'visible';
                            }
                        } else if (isFirstSlide) {
                            // ì²« í˜ì´ì§€ (ìŠ¤í”Œë˜ì‹œ ìŠ¤í¬ë¦°)
                            if (nextButton) {
                                nextButton.style.display = 'block';
                                nextButton.textContent = 'ì‹œì‘í•˜ê¸°';
                            }
                            if (restartButton) restartButton.style.display = 'none';
                            if (exitButton) exitButton.style.display = 'none';
                } else {
                            // ì¤‘ê°„ í˜ì´ì§€ë“¤ (ë‹¨ì–´ ì¹´ë“œ)
                            if (nextButton) {
                                nextButton.style.display = 'block';
                                nextButton.textContent = 'ë‹¤ìŒ';
                            }
                            if (restartButton) restartButton.style.display = 'none';
                            if (exitButton) exitButton.style.display = 'none';
                        }
                    }
                });
            }

            initializeSwiper();
        });
    </script>
</body>
</html>